$(function(){$(".money-input").maskMoney({thousands:".",decimal:",",precision:0,allowZero:!0,suffix:"Ä‘"})}),$(function(){$("#tree2").dynatree({checkbox:!0,selectMode:2,expand:!0,debugLevel:0,children:treeData,onSelect:function(a,b){var c=b.tree.getSelectedNodes(),d=$.map(c,function(a){return a.data.key});$("#echoSelection2").val(d.join(", "))},onClick:function(a,b){"title"===a.getEventTargetType(b)&&a.toggleSelect()},onKeydown:function(a,b){return 32===b.which?(a.toggleSelect(),!1):void 0},onCreate:function(a){a.expand(!0)},cookieId:"dynatree-Cb2",idPrefix:"dynatree-Cb2-"})}),$(function(){var a=$("#tags"),b=a.data("value");a.textext({plugins:"tags autocomplete",tagsItems:b}).bind("getSuggestions",function(a,b){"use strict";var c=$(this).data("suggestions"),d=c.split(","),e=$(a.target).textext()[0],f=(b?b.query:"")||"";$(this).trigger("setSuggestions",{result:e.itemManager().filter(d,f)})}).bind("isTagAllowed",function(a,b){"use strict";var c=$(a.target).textext()[0].tags()._formData,d=!0;if($.each(c,function(a,c){c===b.tag&&(d=!1)}),!d){var e=[b.tag,"is already listed."].join(" ");alert(e),b.result=!1}})}),$(function(){"use strict";var a=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:"pickfiles",container:document.getElementById("uploader"),url:"/admin/file/uploadimage",flash_swf_url:"/admin/themes/jmgroup/plupload/Moxie.swf",silverlight_xap_url:"/admin/themes/jmgroup/plupload/Moxie.xap",filters:{max_file_size:"10mb",mime_types:[{title:"Image files",extensions:"jpg,gif,png,bmp"}]},init:{PostInit:function(){},FilesAdded:function(b,c){var d=document.getElementById("filelist");plupload.each(c,function(a){$(d).append('<div id="'+a.id+'" class="photo-zone large-4 medium-6 columns"><table cellpadding="0" cellspacing="0"><tr><td class="controls"><strong class="progress radius"></strong></td></tr><tr><td class="edit"><span class="name">'+a.name+" ("+plupload.formatSize(a.size)+')</span></td></tr><tr><td class="caption"><textarea rows="4" name="Picture['+a.id+'][caption]" placeholder="Say something about this photo."></textarea></td></tr></table></div>')}),a.start()},UploadProgress:function(a,b){var c=document.getElementById(b.id).getElementsByTagName("strong")[0];$(c).html('<span class="meter" style="width: '+b.percent+'%">'+b.percent+"%</span>")},FileUploaded:function(a,b,c){var d=JSON.parse(c.response),e=document.getElementById(b.id).getElementsByTagName("strong")[0],f=document.getElementById(b.id).getElementsByClassName("edit")[0],g=new Image;d.hasOwnProperty("result")?(e.className+=" success",g.src=d.result.showUrl+d.result.fileName+"."+d.result.fileExt,g.alt="response.result.fileName"):(e.className+=" alert",g.src="",g.alt="error"),g.onload=function(){var a=f.getElementsByClassName("name")[0];$(a).empty().addClass("overflow"),f.appendChild(g)},$.get("/admin/file/processimage",{id:d.id},function(a){var b=JSON.parse(a),c=f.getElementsByClassName("name")[0];g.src=b.result.showUrl+b.result.fileName+"-thumb-upload."+b.result.fileExt,c.className=""});var h=document.getElementById(b.id).getElementsByClassName("controls")[0];$(h).empty().append('<label><input type="radio" name="Product[image_id]" value="'+d.id+'" /> Main picture</label>').append('<a class="delete-image" data-id="'+d.id+'" href="javascript:;"><i class="fa fa-trash-o"></i></a>');var i=document.getElementById(b.id).getElementsByClassName("caption")[0];$(i).append('<input type="hidden" name="Picture['+b.id+'][id]" value="'+d.id+'" />')},UploadComplete:function(a,b){},Error:function(a,b){document.getElementById("console").innerHTML+="\nError #"+b.code+": "+b.message}}});a.init(),$("#filelist").on("click",".delete-image",function(){var a=$(this).data("id"),b=$(this);$.post("/admin/file/delete?id="+a,{},function(a){var c=JSON.parse(a);c.hasOwnProperty("result")&&b.parents(".photo-zone").remove()})}),$(".various").fancybox({padding:0,openEffect:"none",closeEffect:"none",beforeClose:function(){$("#filelist").find("img").each(function(){var a=$(this).attr("src"),b=new Date;$(this).attr("src",a+"?a="+b.getTime())})}})}),$(function(){var a=$(".action-buttons");a.on("click","button",function(){a.children("input").val($(this).data("submit"))})}),$(function(){$(".connected").sortable({connectWith:".connected"}),$("#action-form").on("submit",function(){var a="";$(".related .connected li").each(function(b,c){b>0&&(a+=","),a+=$(this).data("id")}),$("#relatedProduct").val(a);var b=$('input[name="Product[image_id]"]');if(b.length>0){var c=!0;b.each(function(){return $(this).prop("checked")?void(c=!1):void 0}),c&&$(b.get(0)).prop("checked","checked")}})}),function(a){function b(b,c){a(b).change(function(){var b=a(this).val();return b?(a(c).find("a:not(:Contains("+b+"))").parent().slideUp(),a(c).find("a:Contains("+b+")").parent().slideDown()):a(c).find("li").slideDown(),!1}).keyup(function(){a(this).change()})}jQuery.expr[":"].Contains=function(a,b,c){return(a.textContent||a.innerText||"").toUpperCase().indexOf(c[3].toUpperCase())>=0},a(function(){b(a(".search .search-box input"),a(".search .list"))})}(jQuery);