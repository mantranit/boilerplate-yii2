$(function(){var a=$(".page-builder"),b=a.data("href");$.get(b,function(b){a.append(b),$(".modal-button-group .cancel").on("click",function(){$("#"+$(this).data("modalId")).foundation("reveal","close")}),$(".modal-button-group .save.pb-row-btn").on("click",function(){var a=$(this),b=a.parent().parent().serialize(),c=$("#"+a.data("modalId")).data("href"),d=$("#"+a.data("modalId")).data("id");$.post(c,b,function(b){$("#"+a.data("modalId")).foundation("reveal","close"),$("#element"+d).html(b)})}),$(".modal-button-group .save.pb-element-btn").on("click",function(){var a=$(this),b=a.parent().parent().serialize(),c=$("#"+a.data("modalId")).data("href"),d=$("#"+a.data("modalId")).data("itemId");$.post(c+"&"+b,function(b){$("#"+a.data("modalId")).foundation("reveal","close"),$("#column-content-"+d).append(b)})})}),a.on("click",".add-e-pb",function(){var a=$(this),b=a.attr("href");return $.get(b,function(b){a.parent().parent().append(b)}),!1}).on("click",".open-modal.edit-row",function(a){a.preventDefault();var b=$(this),c=$("#"+b.data("revealId"));c.data("href",b.data("urlPost")),c.data("id",b.data("id")),$.get(b.data("urlGet"),function(a){var b=JSON.parse(JSON.parse(a));c.find('[name="container"]').val(b.container),c.find('[name="columnsType"]').val(b.columnsType),c.find('[name="extraClass"]').val(b.extraClass)}),c.foundation("reveal","open")}).on("click",".open-modal.add-element",function(a){a.preventDefault();var b=$(this),c=$("#"+b.data("revealId"));c.data("href",b.data("urlPost")),c.data("itemId",b.data("itemId")),c.find('[name="parent_id"]').val(b.data("id")),c.foundation("reveal","open")}).on("click",".add-e-row",function(){var a=$(this),b=a.attr("href");return $.get(b,function(b){a.parent().parent().append(b)}),!1}).on("click",".active-e-row",function(){var a=$(this),b=a.attr("href");return $.post(b,function(b){var c=JSON.parse(b);c.status?a.removeClass("fa-toggle-on").addClass("fa-toggle-off"):a.removeClass("fa-toggle-off").addClass("fa-toggle-on")}),!1}).on("click",".delete-e-row",function(){var a=$(this),b=a.attr("href");return $.post(b,function(b){var c=JSON.parse(b);c.status&&a.parent().parent().hide()}),!1})}),$(function(){var a=$(".action-buttons");a.on("click","button",function(){a.children("input").val($(this).data("submit"))}),$("#content-using_page_builder").on("click",'input[type="radio"]',function(){$(".radio-group").hide(),$(".radio-group.radio-item-"+$(this).val()).show()}),$("#action-form").on("submit",function(){var a=$('input[name="Content[image_id]"]');if(a.length>0){var b=!0;a.each(function(){return $(this).prop("checked")?void(b=!1):void 0}),b&&$(a.get(0)).prop("checked","checked")}})}),$(function(){var a=$("#tags"),b=a.data("value");a.textext({plugins:"tags autocomplete",tagsItems:b}).bind("getSuggestions",function(a,b){"use strict";var c=$(this).data("suggestions"),d=c.split(","),e=$(a.target).textext()[0],f=(b?b.query:"")||"";$(this).trigger("setSuggestions",{result:e.itemManager().filter(d,f)})}).bind("isTagAllowed",function(a,b){"use strict";var c=$(a.target).textext()[0].tags()._formData,d=!0;if($.each(c,function(a,c){c===b.tag&&(d=!1)}),!d){var e=[b.tag,"is already listed."].join(" ");alert(e),b.result=!1}})}),$(function(){"use strict";var a=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:"pickfiles",container:document.getElementById("uploader"),url:"/admin/file/uploadimage",flash_swf_url:"/admin/themes/jmgroup/plupload/Moxie.swf",silverlight_xap_url:"/admin/themes/jmgroup/plupload/Moxie.xap",filters:{max_file_size:"10mb",mime_types:[{title:"Image files",extensions:"jpg,gif,png,bmp"}]},init:{PostInit:function(){},FilesAdded:function(b,c){var d=document.getElementById("filelist");plupload.each(c,function(a){$(d).append('<div id="'+a.id+'" class="photo-zone columns"><table cellpadding="0" cellspacing="0"><tr><td class="controls"><strong class="progress radius"></strong></td></tr><tr><td class="edit"><span class="name">'+a.name+" ("+plupload.formatSize(a.size)+')</span></td></tr><tr><td class="caption"><textarea rows="4" name="Picture['+a.id+'][caption]" placeholder="Say something about this photo."></textarea></td></tr></table></div>')}),a.start()},UploadProgress:function(a,b){var c=document.getElementById(b.id).getElementsByTagName("strong")[0];$(c).html('<span class="meter" style="width: '+b.percent+'%">'+b.percent+"%</span>")},FileUploaded:function(a,b,c){var d=JSON.parse(c.response),e=document.getElementById(b.id).getElementsByTagName("strong")[0],f=document.getElementById(b.id).getElementsByClassName("edit")[0],g=new Image;d.hasOwnProperty("result")?(e.className+=" success",g.src=d.result.showUrl+d.result.fileName+"."+d.result.fileExt,g.alt="response.result.fileName"):(e.className+=" alert",g.src="",g.alt="error"),g.onload=function(){var a=f.getElementsByClassName("name")[0];$(a).empty().addClass("overflow"),f.appendChild(g)},$.get("/admin/file/processimage",{id:d.id},function(a){var b=JSON.parse(a),c=f.getElementsByClassName("name")[0];g.src=b.result.showUrl+b.result.fileName+"-thumb-upload."+b.result.fileExt,c.className=""});var h=document.getElementById(b.id).getElementsByClassName("controls")[0];$(h).empty().append('<label><input type="radio" name="Product[image_id]" value="'+d.id+'" /> Main picture</label>').append('<a class="delete-image" data-id="'+d.id+'" href="javascript:;"><i class="fa fa-trash-o"></i></a>');var i=document.getElementById(b.id).getElementsByClassName("caption")[0];$(i).append('<input type="hidden" name="Picture['+b.id+'][id]" value="'+d.id+'" />')},UploadComplete:function(a,b){},Error:function(a,b){document.getElementById("console").innerHTML+="\nError #"+b.code+": "+b.message}}});a.init(),$("#filelist").on("click",".delete-image",function(){var a=$(this).data("id"),b=$(this);$.post("/admin/file/delete?id="+a,{},function(a){var c=JSON.parse(a);c.hasOwnProperty("result")&&b.parents(".photo-zone").remove()})})});