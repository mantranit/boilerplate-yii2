$(function(){function a(a){var b=a.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+)/i);return b&&4===b.length?"#"+("0"+parseInt(b[1],10).toString(16)).slice(-2)+("0"+parseInt(b[2],10).toString(16)).slice(-2)+("0"+parseInt(b[3],10).toString(16)).slice(-2):a}var b=new fabric.Canvas("canvas"),c=$("#canvas"),d=$("#add-watermask-button"),e=$("#delete-watermask-button"),f=$("#add-text-button"),g=$("#add-frame-button"),h=$("#color-opacity-controls"),i=h.find('input[type="range"]'),j=h.find('input[type="color"]');b.setBackgroundImage(c.data("background"),b.renderAll.bind(b)),d.on("click",function(){mihaildev.elFinder.openManager({filter:"image",path:"image",callback:"addImage",url:"/admin/elfinder/manager?filter=image&path=image&callback=addImage",width:"auto",height:"auto",id:"addImage"})}),mihaildev.elFinder.register("addImage",function(a,c){var d=new Image;return d.src=a.url,d.onload=function(){var a=new fabric.Image(d,{left:10,top:10});b.add(a)},!0}),e.on("click",function(){var a=b.getActiveObject();b.remove(a)}),f.on("click",function(){var a=new fabric.IText("www.vitinhgiatot.com",{left:100,top:100,fontFamily:"Arial"});b.add(a)}),g.on("click",function(){var a=new fabric.Rect({left:100,top:50,width:100,height:100,fill:"green",angle:20,padding:10});b.add(a)}),i.on("change",function(){var a=b.getActiveObject();a.setOpacity($(this).val()/100),b.renderAll()}),j.on("change",function(){var a=b.getActiveObject();a.setColor($(this).val()),b.renderAll()}),b.on("object:selected",function(){var c=b.getActiveObject();void 0!==c.text?h.show():h.hide(),i.val(100*c.opacity),j.val(a(c.fill)),b.renderAll(),e.removeAttr("disabled").addClass("alert").removeClass("disabled")}),b.on("selection:cleared",function(){e.attr("disabled","disabled").removeClass("alert").addClass("disabled"),h.hide()}),$("#watermask-save").on("click",function(){var a=$(this).data("submit");$.post(a,{fabric:JSON.stringify(b)},function(a){window.open(a.src,"Review","width=600,height=400,resizable=1")})})});